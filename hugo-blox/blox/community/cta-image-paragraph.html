{{/* cta-image-paragraph (override comunitario)
     - Si items[n].video_url está definido, muestra un iframe de YouTube en lugar de la imagen.
     - Fallback a imagen si no hay video_url.
*/}}

{{ $b := .block }}
{{ $content := (index $b "content") | default dict }}
{{ $items := (index $content "items") | default (slice) }}
{{ $design := (index $b "design") | default dict }}
{{ $css := (index $design "css_class") | default "" }}

<section id="{{ (index $b "id") | default "" }}" class="{{ $css }}">
  <div class="container mx-auto px-6">
    {{ range $items }}
      <div class="grid md:grid-cols-2 gap-8 items-center py-6">
        {{/* Lado media (video o imagen) */}}
        <div class="w-full">
          {{ $video := (index . "video_url") }}
          {{ if $video }}
            {{/* Extraer ID de YouTube de youtu.be o youtube.com/watch?v= */}}
            {{ $id := $video | replace "https://youtu.be/" "" | replace "http://youtu.be/" "" | replace "https://www.youtube.com/watch?v=" "" | replace "https://youtube.com/watch?v=" "" }}
            {{ $id = (index (split $id "?") 0) }}
            {{ $id = (index (split $id "&") 0) }}
            <div class="w-full aspect-video rounded-xl overflow-hidden shadow">
              <iframe
                class="w-full h-full"
                src="https://www.youtube.com/embed/{{ $id }}"
                title="{{ (index . "title") | default "Video" }}"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                referrerpolicy="strict-origin-when-cross-origin"
                allowfullscreen></iframe>
            </div>
          {{ else }}
            {{ with (index . "image") }}
              <img class="w-full rounded-xl shadow" src="{{ . | relURL }}" alt="{{ (index $ . "title") | default "Imagen" }}">
            {{ end }}
          {{ end }}
        </div>

        {{/* Lado texto */}}
        <div>
          {{ with (index . "title") }}<h3 class="text-2xl font-bold mb-2">{{ . }}</h3>{{ end }}
          {{ with (index . "text") }}<div class="prose dark:prose-invert max-w-none mb-4">{{ . | markdownify }}</div>{{ end }}
          {{ with (index . "button") }}
            {{ $btnText := (index . "text") | default "Ver más" }}
            {{ $btnUrl  := (index . "url")  | default "#" }}
            <a href="{{ $btnUrl }}" class="inline-block px-5 py-2 rounded-lg bg-primary-600 text-white hover:bg-primary-700 transition">
              {{ $btnText }}
            </a>
          {{ end }}
        </div>
      </div>
    {{ end }}
  </div>
</section>
