{{/* community/people.html
     Bloque "people" filtrado por content.user_groups.
     Espera:
       - .block.content.user_groups: [ "Equipo", "Consejo Asesor", ... ]
       - .block.content.title, .block.content.text (opcional)
       - .block.content.start_open (bool, opcional)
       - .block.design.columns (int, opcional - default 4)
       - .block.design.compact (bool, opcional)
     Los perfiles deben estar en la sección "authors" con front matter:
       user_groups: ["Equipo", ...]
*/}}

{{ $b := .block }}
{{ $c := (index $b "content") | default dict }}
{{ $d := (index $b "design")  | default dict }}

{{ $title      := (index $c "title") | default "" }}
{{ $text       := (index $c "text")  | default "" }}
{{ $wanted     := (index $c "user_groups") | default (slice) }}
{{ $startOpen  := (index $c "start_open") | default false }}

{{ $columns    := (index $d "columns") | default 4 }}
{{ $compact    := (index $d "compact")  | default false }}

{{/* Clases utilitarias */}}
{{ $pad := cond $compact "py-6" "py-10" }}
{{ $colsClass := printf "md:grid-cols-%d" $columns }}

<section id="{{ (index $b "id") | default (anchorize $title) }}" class="{{ $pad }}">
  <div class="container mx-auto px-6 text-gray-900 dark:text-gray-100">
    <details {{ if $startOpen }}open{{ end }} class="group">
      <summary class="cursor-pointer select-none flex items-center justify-between gap-4 py-3">
        <div>
          {{ if $title }}<h2 class="text-2xl font-bold">{{ $title }}</h2>{{ end }}
          {{ if $text }}<div class="mt-1 opacity-80">{{ $text | markdownify }}</div>{{ end }}
        </div>
        <span class="text-sm opacity-70 group-open:rotate-180 transition">▾</span>
      </summary>

      {{/* Obtener todas las páginas de autores */}}
      {{ $all := where site.Pages "Section" "authors" }}

      {{/* Filtrar por intersección de grupos */}}
      {{ $filtered := slice }}
      {{ $sc := newScratch }}
      {{ $sc.Set "filtered" (slice) }}
      {{ range $all }}
        {{ $ug := .Params.user_groups | default (slice) }}
        {{ $common := intersect $ug $wanted }}
        {{ if gt (len $common) 0 }}
          {{ $sc.Add "filtered" (slice .) }}
        {{ end }}
      {{ end }}
      {{ $filtered = $sc.Get "filtered" }}

      {{ if gt (len $filtered) 0 }}
        <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 {{ $colsClass }} gap-6">
          {{ range sort $filtered "Title" }}
            <article class="rounded-xl border border-gray-200/60 dark:border-gray-700/60 p-4">
              <h3 class="font-semibold text-lg">{{ .Title }}</h3>
              {{ with .Params.role }}
                <p class="text-sm opacity-80 mt-1">{{ . }}</p>
              {{ end }}
              {{/* Podés agregar más campos si querés:
                    - .Params.organizations
                    - .Params.interests
                    - .Params.social (links)
                 */}}
            </article>
          {{ end }}
        </div>
      {{ else }}
        <div class="mt-4 text-sm opacity-80">
          No se encontraron personas en los grupos:
          <code>{{ delimit $wanted ", " }}</code>.
        </div>
      {{ end }}
    </details>
  </div>
</section>
