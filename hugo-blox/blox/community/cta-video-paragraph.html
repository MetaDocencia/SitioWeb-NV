{{/* Bloque comunitario: cta-video-paragraph
     - Igual a "cta-image-paragraph", pero con video embebido.
     - Usa content.items[].video_url (YouTube) + title, text, button.
*/}}

{{ $b := .block }}
{{ $content := (index $b "content") | default dict }}
{{ $items := (index $content "items") | default (slice) }}
{{ $design := (index $b "design") | default dict }}
{{ $css := (index $design "css_class") | default "" }}

<section id="{{ (index $b "id") | default "" }}" class="{{ $css }}">
  <div class="container mx-auto px-6">
    {{ range $items }}
      <div class="grid md:grid-cols-2 gap-8 items-center py-6">
        <!-- Media (video YouTube) -->
        <div class="w-full">
          {{ $video := (index . "video_url") }}
          {{ if $video }}
            {{/* Extrae ID de youtu.be / watch?v= / embed / shorts */}}
            {{ $id := $video }}
            {{ $id = replace $id "https://youtu.be/" "" }}
            {{ $id = replace $id "http://youtu.be/" "" }}
            {{ $id = replace $id "https://www.youtube.com/watch?v=" "" }}
            {{ $id = replace $id "https://youtube.com/watch?v=" "" }}
            {{ $id = replace $id "https://www.youtube.com/embed/" "" }}
            {{ $id = replace $id "https://youtube.com/embed/" "" }}
            {{ $id = replace $id "https://www.youtube.com/shorts/" "" }}
            {{ $id = replace $id "https://youtube.com/shorts/" "" }}
            {{ $id = index (split $id "?") 0 }}
            {{ $id = index (split $id "&") 0 }}
            {{ $id = index (split $id "/") 0 }}
            <div class="w-full aspect-video rounded-xl overflow-hidden shadow">
              <iframe
                class="w-full h-full"
                src="https://www.youtube.com/embed/{{ $id }}"
                title="{{ (index . "title") | default "Video" }}"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                referrerpolicy="strict-origin-when-cross-origin"
                allowfullscreen></iframe>
            </div>
          {{ else }}
            <div class="text-gray-500 dark:text-gray-400">Falta <code>video_url</code> en este item.</div>
          {{ end }}
        </div>

        <!-- Texto y botón -->
        <div>
          {{ with (index . "title") }}<h3 class="text-2xl font-bold mb-2">{{ . }}</h3>{{ end }}
          {{ with (index . "text") }}<div class="prose dark:prose-invert max-w-none mb-4">{{ . | markdownify }}</div>{{ end }}
          {{ with (index . "button") }}
            {{ $btnText := (index . "text") | default "Ver más" }}
            {{ $btnUrl  := (index . "url")  | default "#" }}
            <a href="{{ $btnUrl }}" class="inline-block px-5 py-2 rounded-lg bg-primary-600 text-white hover:bg-primary-700 transition">
              {{ $btnText }}
            </a>
          {{ end }}
        </div>
      </div>
    {{ end }}
  </div>
</section>
