{{/* features-colored: grid con badge circular de color por ítem
     - Robustez extra de lectura:
       * Lee .block.content vía index y vía dot (fallback)
       * Lee items desde content.items o content.features (index y dot)
       * Soporta name|title, description|text|content, icon_color|color
     - Si no hay ítems, muestra aviso (no desaparece silenciosamente)
*/}}

{{ $b := .block | default dict }}

{{/* --- content robusto --- */}}
{{ $content := (index $b "content") }}
{{ if not $content }}{{ with $b.content }}{{ $content = . }}{{ end }}{{ end }}
{{ if not $content }}{{ $content = dict }}{{ end }}

{{/* --- items robusto --- */}}
{{ $items := (index $content "items") }}
{{ if not $items }}{{ with $content.items }}{{ $items = . }}{{ end }}{{ end }}
{{ if not $items }}{{ $items = (index $content "features") }}{{ end }}
{{ if not $items }}{{ with $content.features }}{{ $items = . }}{{ end }}{{ end }}
{{ if not $items }}{{ $items = (slice) }}{{ end }}

{{/* --- diseño: columnas --- */}}
{{ $design := (index $b "design") | default dict }}
{{ if not $design }}{{ with $b.design }}{{ $design = . }}{{ end }}{{ end }}
{{ $cols := (index $design "columns") | default 3 }}
{{ $grid := "grid-cols-1 sm:grid-cols-2 lg:grid-cols-3" }}
{{ if eq $cols 2 }}{{ $grid = "grid-cols-1 sm:grid-cols-2" }}{{ end }}
{{ if eq $cols 4 }}{{ $grid = "grid-cols-1 sm:grid-cols-2 lg:grid-cols-4" }}{{ end }}
{{ if eq $cols 5 }}{{ $grid = "grid-cols-1 sm:grid-cols-2 lg:grid-cols-5" }}{{ end }}

<section id="{{ (index $b "id") | default "features-colored" }}" class="py-8">
  <div class="container mx-auto px-6">
    {{ if gt (len $items) 0 }}
      <div class="grid {{ $grid }} gap-6">
        {{ range $items }}
          {{ $name  := or .name .title | default "" }}
          {{ $desc  := or .description .text .content | default "" }}
          {{ $badge := .badge | default "" }}
          {{ $color := or .icon_color .color | default "#4B5563" }}
          <div class="rounded-2xl border bg-white dark:bg-gray-900 shadow-sm p-6 flex flex-col text-gray-900 dark:text-gray-100">
            <div class="flex items-center gap-4 mb-3">
              <span class="inline-flex items-center justify-center w-10 h-10 rounded-full text-white font-bold text-xs"
                    style="background-color: {{ $color }};">
                {{ $badge }}
              </span>
              <h3 class="text-lg font-semibold leading-snug m-0">{{ $name }}</h3>
            </div>
            <div class="prose dark:prose-invert max-w-none text-sm grow">
              {{ $desc | markdownify }}
            </div>
          </div>
        {{ end }}
      </div>
    {{ else }}
      <div class="rounded-xl border p-6 text-center text-sm text-gray-600 dark:text-gray-300 bg-white dark:bg-gray-900">
        No se encontraron ítems para este bloque (<code>features-colored</code>). Verifica que <code>content.items</code> o <code>content.features</code> contengan elementos.
      </div>
    {{ end }}
  </div>
</section>
