{{/* Shortcode: people_list
     Uso: {{</* people_list group="Colaboradores" */>}}
*/}}

{{- $group    := (.Get "group") | default "Colaboradores" -}}
{{- $authors  := where site.Pages "Section" "authors" -}}
{{- $filtered := slice -}}

{{- range $authors -}}
  {{- $ug := .Params.user_groups -}}
  {{- if and $ug (gt (len (intersect $ug (slice $group))) 0) -}}
    {{- $filtered = $filtered | append . -}}
  {{- end -}}
{{- end -}}

{{- $filtered = sort $filtered ".Params.weight" | sort "Title" -}}

<div class="w-full">
  <!-- Más separación entre tarjetas: gap-x-12 gap-y-14 -->
  <div class="grid grid-cols-3 md:grid-cols-4 xl:grid-cols-7 gap-x-12 gap-y-14 place-items-center">
    {{- range $p := $filtered -}}
      <a href="{{ $p.RelPermalink }}" class="block text-center no-underline hover:opacity-90">
        <div class="mx-auto w-28 h-28 rounded-full overflow-hidden">
          {{- with $p.Resources.GetMatch "avatar*" -}}
            <img src="{{ .RelPermalink }}" alt="{{ $p.Title }}" loading="lazy"
                 class="w-full h-full object-cover object-center">
          {{- else -}}
            {{- with $p.Params.image -}}
              <img src="{{ . | relURL }}" alt="{{ $p.Title }}" loading="lazy"
                   class="w-full h-full object-cover object-center">
            {{- else -}}
              <div class="w-full h-full bg-gray-200 dark:bg-gray-700"></div>
            {{- end -}}
          {{- end -}}
        </div>
        <div class="mt-2">
          <div class="font-semibold leading-tight">{{ $p.Title }}</div>
          {{- with $p.Params.role }}<div class="text-sm opacity-70 leading-tight">{{ . }}</div>{{- end -}}
          {{- with (index $p.Params "organizations") -}}
            {{- with (index . 0) -}}
              {{- with .name }}<div class="text-sm opacity-70 leading-tight">{{ . }}</div>{{- end -}}
            {{- end -}}
          {{- end -}}
        </div>
      </a>
    {{- end -}}
  </div>
</div>
