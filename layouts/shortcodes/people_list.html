{{/* Shortcode: people_list — Lista de autores filtrada por uno o varios user_groups.
     Parámetros:
       - group="Nombre"                → un grupo
       - groups="Grupo A, Grupo B"     → varios (coma o |)
       - cols=7                        → columnas en XL (3 mobile, 4 md)
       - gapx=12 gapy=14               → separación horizontal/vertical
       - limit=0                       → 0/omitido = sin límite
     Sin group(s) → muestra TODOS los autores.
*/}}

{{- /* --- Parseo de parámetros --- */ -}}
{{- $paramGroups := or (.Get "groups") (.Get "group") -}}
{{- $wanted := slice -}}
{{- if $paramGroups -}}
  {{- $sep := "," -}}
  {{- if in $paramGroups "|" }}{{ $sep = "|" }}{{ end -}}
  {{- range (split $paramGroups $sep) -}}
    {{- $g := strings.TrimSpace . -}}
    {{- if $g }}{{ $wanted = $wanted | append $g }}{{ end -}}
  {{- end -}}
{{- end -}}

{{- $cols  := or (.Get "cols") 7 -}}
{{- $gapx  := or (.Get "gapx") 12 -}}
{{- $gapy  := or (.Get "gapy") 14 -}}
{{- $limit := or (.Get "limit") 0 -}}

{{- /* --- Base: solo páginas de la sección authors --- */ -}}
{{- $authors := where site.RegularPages "Section" "authors" -}}

{{- /* --- Filtro por grupos si los pidieron --- */ -}}
{{- if gt (len $wanted) 0 -}}
  {{- $filtered := slice -}}
  {{- range $authors -}}
    {{- $ug := .Params.user_groups | default (slice) -}}
    {{- if gt (len (intersect $ug $wanted)) 0 -}}
      {{- $filtered = $filtered | append . -}}
    {{- end -}}
  {{- end -}}
  {{- $authors = $filtered -}}
{{- end -}}

{{- /* --- Orden estable: primero weight, luego Title (separado, sin pipes) --- */ -}}
{{- $authors = sort $authors "Params.weight" -}}
{{- $authors = sort $authors "Title" -}}

{{- if and $limit (gt $limit 0) -}}
  {{- $authors = first $limit $authors -}}
{{- end -}}

<div class="w-full">
  <div class="grid grid-cols-3 md:grid-cols-4 xl:grid-cols-{{ $cols }} gap-x-{{ $gapx }} gap-y-{{ $gapy }} place-items-center">
    {{- range $p := $authors -}}
      <a href="{{ $p.RelPermalink }}" class="block text-center no-underline hover:opacity-90">
        <div class="mx-auto w-28 h-28 rounded-full overflow-hidden">
          {{- with $p.Resources.GetMatch "avatar*" -}}
            <img src="{{ .RelPermalink }}" alt="{{ $p.Title }}" loading="lazy"
                 class="w-full h-full object-cover object-center">
          {{- else -}}
            {{- with $p.Params.image -}}
              <img src="{{ . | relURL }}" alt="{{ $p.Title }}" loading="lazy"
                   class="w-full h-full object-cover object-center">
            {{- else -}}
              <div class="w-full h-full bg-gray-200 dark:bg-gray-700"></div>
            {{- end -}}
          {{- end -}}
        </div>
        <div class="mt-2">
          <div class="font-semibold leading-tight">{{ $p.Title }}</div>
          {{- with $p.Params.role }}<div class="text-sm opacity-70 leading-tight">{{ . }}</div>{{- end -}}
          {{- with (index $p.Params "organizations") -}}
            {{- with (index . 0) -}}
              {{- with .name }}<div class="text-sm opacity-70 leading-tight">{{ . }}</div>{{- end -}}
            {{- end -}}
          {{- end -}}
        </div>
      </a>
    {{- end -}}
  </div>
</div>
