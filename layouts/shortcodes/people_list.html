{{/* Shortcode: people_list (versión background + separación estable)

Params:
  - group="Colaboradores"                (o "Auspiciantes, Colaboradores")
  - columns=7                            (desktop/XL)
  - fit="cover" | "contain"              (recorte del avatar)
  - gapx="2rem"  gapy="2.25rem"          (separación horizontal/vertical)
*/}}

{{- $groupsParam := .Get "group" | default "" -}}
{{- $cols       := .Get "columns" | default 7 -}}
{{- $fit        := .Get "fit"     | default "cover" -}}
{{- $gapx       := .Get "gapx"    | default "2rem" -}}
{{- $gapy       := .Get "gapy"    | default "2.25rem" -}}

{{/* Normalizo grupos a slice */}}
{{- $groups := slice -}}
{{- if $groupsParam -}}
  {{- range (split $groupsParam ",") -}}
    {{- $g := strings.TrimSpace . -}}
    {{- if $g }}{{ $groups = $groups | append $g }}{{ end -}}
  {{- end -}}
{{- end -}}

{{/* Tomo autores (usar site.Pages para bundles con _index.md) */}}
{{- $authors := where site.Pages "Section" "authors" -}}

{{/* Filtro por user_groups si se pidió */}}
{{- if gt (len $groups) 0 -}}
  {{- $filtered := slice -}}
  {{- range $authors -}}
    {{- $ug := .Params.user_groups | default (slice) -}}
    {{- if gt (len (intersect $ug $groups)) 0 -}}
      {{- $filtered = $filtered | append . -}}
    {{- end -}}
  {{- end -}}
  {{- $authors = $filtered -}}
{{- end -}}

{{/* Orden: weight, luego Title (hacerlo en dos pasos) */}}
{{- $authors = sort $authors "Params.weight" -}}
{{- $authors = sort $authors "Title" -}}

<div class="w-full px-0 mx-auto">
  <!-- 3 cols en mobile / 3 en md / {{ $cols }} en XL.
       La separación no depende de clases dinámicas: va inline para no romper Tailwind. -->
  <div class="grid grid-cols-3 md:grid-cols-3 xl:grid-cols-{{ $cols }}" style="column-gap: {{ $gapx }}; row-gap: {{ $gapy }};">
    {{- range $p := $authors -}}
      {{- $img := "" -}}
      {{- with $p.Resources.GetMatch "avatar*" -}}
        {{- $img = .RelPermalink -}}
      {{- else -}}
        {{- with $p.Params.image -}}{{- $img = ( . | relURL ) -}}{{- end -}}
      {{- end -}}

      <a href="{{ $p.RelPermalink }}" class="block text-center no-underline hover:opacity-90" style="padding: 0.125rem;">
        <div class="mx-auto rounded-full"
             style="width:7rem;height:7rem;background:#e5e7eb;{{ if $img }}background-image:url('{{ $img }}');{{ end }}background-repeat:no-repeat;background-size:{{ $fit }};background-position:center;">
        </div>
        <div class="mt-3">
          <div class="font-semibold leading-tight" style="text-decoration:none;">{{ $p.Title }}</div>
          {{- with $p.Params.role }}<div class="text-sm opacity-70 leading-tight">{{ . }}</div>{{- end -}}
        </div>
      </a>
    {{- end -}}
  </div>
</div>
