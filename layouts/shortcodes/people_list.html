{{/* Shortcode: people_list
     Params:
       - group    : string o lista separada por comas (ej: "Colaboradores" o "Auspiciantes,Colaboradores")
       - columns  : columnas en desktop (default 7). En mobile se fuerza a 3.
       - fit      : "cover" (default) o "contain" para el recorte.
*/}}

{{- $groupsParam := .Get "group" | default "" -}}
{{- $cols        := .Get "columns" | default "7" -}}
{{- $fit         := .Get "fit" | default "cover" -}}

{{/* Normalizo grupos a slice */}}
{{- $groups := slice -}}
{{- if $groupsParam -}}
  {{- range (split $groupsParam ",") -}}
    {{- $g := trim . " " -}}
    {{- if $g }}{{ $groups = $groups | append $g }}{{ end -}}
  {{- end -}}
{{- end -}}

{{/* Tomo autores */}}
{{- $authors := where site.Pages "Section" "authors" -}}

{{/* Filtro por user_groups si se pidi√≥ */}}
{{- if gt (len $groups) 0 -}}
  {{- $filtered := slice -}}
  {{- range $authors -}}
    {{- $ug := .Params.user_groups -}}
    {{- if and $ug (gt (len (intersect $ug $groups)) 0) -}}
      {{- $filtered = $filtered | append . -}}
    {{- end -}}
  {{- end -}}
  {{- $authors = $filtered -}}
{{- end -}}

{{/* Orden: weight, luego Title */}}
{{- $authors = sort $authors "Params.weight" "asc" -}}
{{- $authors = sort $authors "Title" "asc" -}}

<div class="w-full px-0 mx-auto">
  {{ if gt (len $authors) 0 }}
    <div class="grid gap-x-8 gap-y-10 grid-cols-3 md:grid-cols-3 xl:grid-cols-{{ $cols }}">
      {{ range $p := $authors }}
        {{- $img := "" -}}
        {{- with $p.Resources.GetMatch "avatar*" -}}
          {{- $img = .RelPermalink -}}
        {{- else -}}
          {{- with $p.Params.image -}}{{ $img = ( . | relURL ) }}{{- end -}}
        {{- end -}}

        <a href="{{ $p.RelPermalink }}" class="block text-center no-underline hover:opacity-90">
          <div class="mx-auto rounded-full"
               style="width:7rem;height:7rem; background:#e5e7eb; {{ if $img }}background-image:url('{{ $img }}');{{ end }} background-size:{{ $fit }}; background-position:center;">
          </div>
          <div class="mt-3">
            <div class="font-semibold leading-tight" style="text-decoration:none;">{{ $p.Title }}</div>
            {{ with $p.Params.role }}<div class="text-sm opacity-70 leading-tight">{{ . }}</div>{{ end }}
          </div>
        </a>
      {{ end }}
    </div>
  {{ else }}
    <div class="text-center text-gray-500 dark:text-gray-400">
      {{ if gt (len $groups) 0 }}
        No se encontraron perfiles en: {{ delimit $groups ", " " y " }}.
      {{ else }}
        No se encontraron perfiles en <code>content/authors/</code>.
      {{ end }}
    </div>
  {{ end }}
</div>
