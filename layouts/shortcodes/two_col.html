{{/* Shortcode: two_col
   Dos columnas con imagen y texto.

   Parámetros:
   - image: ruta a la imagen (Page Resource, assets o /static)
   - side: "img-left" | "img-right"  (posición de la imagen en desktop)
   - mode: "container" | "full"      (ancho contenido: centrado o a todo ancho)
   - maxw: ancho máx. del contenido (cuando mode="container")
   - px:   padding horizontal interno
   - gap:  separación entre columnas
   - imgw: ancho máx. de la imagen
   - alt:  texto alternativo

   Ejemplo:
   {{< two_col image="/media/slack.png" side="img-left" mode="container" maxw="1100px" px="clamp(.75rem,3vw,1.5rem)" gap="clamp(1rem,3vw,2rem)" imgw="380px" alt="Slack de MetaDocencia" >}}
     ...contenido HTML/Markdown de la columna de texto...
   {{< /two_col >}}
*/}}

{{- $image := .Get "image" -}}
{{- $sideRaw := lower (.Get "side" | default "img-right") -}}
{{- $side := cond (or (eq $sideRaw "left") (eq $sideRaw "img-left")) "img-left" "img-right" -}}

{{- $mode := lower (.Get "mode" | default "container") -}}
{{- $maxw := .Get "maxw" | default "1200px" -}}
{{- $px   := .Get "px"   | default "clamp(0.75rem,3vw,1.5rem)" -}}
{{- $gap  := .Get "gap"  | default "clamp(1rem,3vw,2rem)" -}}
{{- $imgw := .Get "imgw" | default "360px" -}}
{{- $alt  := .Get "alt"  | default "" -}}

{{/* Resolver URL de imagen: Page Resource -> assets -> static */}}
{{- $imgURL := "" -}}
{{- with .Page.Resources.GetMatch $image -}}
  {{- $imgURL = .RelPermalink -}}
{{- else -}}
  {{- with resources.Get $image -}}
    {{- $imgURL = .RelPermalink -}}
  {{- else -}}
    {{- $imgURL = ( $image | relURL ) -}}
  {{- end -}}
{{- end -}}

<div class="md-two-col-outer" data-mode="{{ $mode }}">
  <style>
    .md-two-col-outer[data-mode="full"]{
      position:relative; left:50%; right:50%;
      margin-left:-50vw; margin-right:-50vw; width:100vw;
    }
    .md-two-col{max-width:var(--maxw); margin:0 auto; padding-left:var(--px); padding-right:var(--px);}
    .md-two-col .md-grid{
      display:grid !important; gap:var(--gap); align-items:center;
      grid-template-columns:1fr 1fr; grid-template-areas:"media text";
    }
    .md-two-col[data-side="img-left"]  .md-grid{grid-template-areas:"media text";}
    .md-two-col[data-side="img-right"] .md-grid{grid-template-areas:"text media";}
    .md-two-col .md-media{grid-area:media}
    .md-two-col .md-text{grid-area:text; text-align:left}
    @media (max-width:900px){
      .md-two-col .md-grid{grid-template-columns:1fr; grid-template-areas:"text" "media";}
    }
    .md-two-col .md-media img{width:min(var(--imgw),100%); height:auto; display:block; margin:0 auto}
  </style>

  <div class="md-two-col" data-side="{{ $side }}" style="--maxw:{{ $maxw }}; --px:{{ $px }}; --gap:{{ $gap }}; --imgw:{{ $imgw }};">
    <div class="md-grid">
      <div class="md-media"><img src="{{ $imgURL }}" alt="{{ $alt }}" loading="lazy"></div>
      <div class="md-text">{{ .Inner | .Page.RenderString }}</div>
    </div>
  </div>
</div>
