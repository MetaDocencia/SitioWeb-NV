{{ define "main" }}
<section class="mx-auto px-6 py-10 max-w-5xl">

  <!-- Título -->
  <h1 class="text-3xl font-extrabold tracking-tight mb-6">Blog</h1>

  <!-- Filtro por categorías -->
  {{ $labelAll := cond (eq .Site.Language.Lang "es") "Todas" "All" }}
  {{ with site.Taxonomies.categories }}
    <div id="cat-filter" class="flex flex-wrap gap-2 mb-8">
      <button type="button"
              class="px-3 py-1 rounded-full border border-gray-300 text-gray-700 dark:border-gray-700 dark:text-gray-200"
              data-cat="__all__">{{ $labelAll }}</button>
      {{ range $name, $_ := . }}
        <button type="button"
                class="px-3 py-1 rounded-full bg-gray-100 text-gray-800 hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-100 dark:hover:bg-gray-700"
                data-cat="{{ $name | urlize }}">{{ $name }}</button>
      {{ end }}
    </div>
  {{ end }}

  <!-- Lista de artículos (uno debajo del otro, sin recuadro) -->
  {{ $pages := .Pages.ByDate.Reverse }}
  {{ $p := .Paginate $pages }}

  <div id="post-list" class="divide-y divide-gray-200 dark:divide-gray-800">
    {{ range $p.Pages }}
      {{ $cats := slice }}{{ with .Params.categories }}{{ range . }}{{ $cats = $cats | append (urlize .) }}{{ end }}{{ end }}
      <article class="py-6" data-cats="{{ delimit $cats " " }}">
        <div class="flex flex-col sm:flex-row sm:items-start gap-4 sm:gap-6">
          <!-- Fecha a la izquierda -->
          <time class="sm:w-28 shrink-0 text-sm text-gray-500 dark:text-gray-400 sm:mt-1"
                datetime="{{ .Date.Format "2006-01-02" }}">
            {{ .Date.Format "2006-01-02" }}
          </time>

          <!-- Contenido a la derecha -->
          <div class="min-w-0">
            <h2 class="text-xl font-semibold leading-snug">
              <a href="{{ .RelPermalink }}" class="hover:underline">{{ .Title }}</a>
            </h2>

            <div class="mt-1 text-xs text-gray-500 dark:text-gray-400 flex flex-wrap items-center gap-x-2 gap-y-1">
              <span>{{ .ReadingTime }} min</span>
              {{ with .Params.authors }}<span>·</span><span>{{ delimit . ", " }}</span>{{ end }}

              {{ with .Params.tags }}
                {{ if gt (len .) 0 }}
                  <span>·</span>
                  <span>
                    {{- $last := sub (len .) 1 -}}
                    {{- range $i, $t := . -}}
                      <a class="underline hover:no-underline"
                         href="{{ (printf "/tags/%s/" (urlize $t)) | relLangURL }}">{{ $t }}</a>{{ if lt $i $last }}, {{ end }}
                    {{- end -}}
                  </span>
                {{ end }}
              {{ end }}
            </div>

            {{ $sum := .Params.summary }}
            {{ if not $sum }}{{ $sum = ( .Plain | truncate 220 ) }}{{ end }}
            {{ with $sum }}
              <p class="mt-2 text-sm text-gray-700 dark:text-gray-200">{{ . | safeHTML }}</p>
            {{ end }}
          </div>
        </div>
      </article>
    {{ end }}
  </div>

  <!-- Paginación -->
  <div class="mt-8">
    {{ template "_internal/pagination.html" . }}
  </div>

  <!-- JS filtro por categoría -->
  <script>
    (function(){
      const chips = Array.from(document.querySelectorAll('#cat-filter [data-cat]'));
      const items = Array.from(document.querySelectorAll('#post-list article'));
      let current = '__all__';
      function apply(){
        items.forEach(el=>{
          const cats = (el.dataset.cats || '').split(/\s+/).filter(Boolean);
          el.style.display = (current==='__all__' || cats.includes(current)) ? '' : 'none';
        });
      }
      chips.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          chips.forEach(b=>b.classList.remove('ring-1','ring-gray-400'));
          btn.classList.add('ring-1','ring-gray-400');
          current = btn.dataset.cat;
          apply();
        });
      });
    })();
  </script>
</section>
{{ end }}
