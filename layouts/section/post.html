{{ define "main" }}
<section class="mx-auto px-6 py-10 max-w-5xl">
  <!-- Título -->
  <h1 class="text-3xl font-extrabold tracking-tight mb-6">Blog</h1>

  <!-- Filtro por categorías -->
  {{ $labelAll := cond (eq .Site.Language.Lang "es") "Todas" "All" }}
  {{ with site.Taxonomies.categories }}
    <div id="cat-filter" class="flex flex-wrap gap-2 mb-8">
      <button type="button"
              class="px-3 py-1 rounded-full border border-gray-300 text-gray-700 dark:border-gray-700 dark:text-gray-200 ring-1 ring-gray-400"
              data-cat="__all__">{{ $labelAll }}</button>
      {{ range $name, $_ := . }}
        <button type="button"
                class="px-3 py-1 rounded-full bg-gray-100 text-gray-800 hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-100 dark:hover:bg-gray-700"
                data-cat="{{ $name | urlize }}">{{ $name }}</button>
      {{ end }}
    </div>
  {{ end }}

  <!-- Colección de posts (tarjetas minimalistas) -->
  {{ $pages := .Pages.ByDate.Reverse }}
  {{ $p := .Paginate $pages }}
  <div id="post-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-6">
    {{ range $p.Pages }}
      {{ $cats := slice }}{{ with .Params.categories }}{{ range . }}{{ $cats = $cats | append (urlize .) }}{{ end }}{{ end }}
      <article class="relative rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#0b0f19] p-4 hover:shadow-md transition"
               data-cats="{{ delimit $cats " " }}">
        <h2 class="text-lg font-semibold leading-snug mb-1">
          <a href="{{ .RelPermalink }}" class="hover:underline">{{ .Title }}</a>
        </h2>

        <div class="text-xs text-gray-500 dark:text-gray-400 flex flex-wrap items-center gap-x-2 gap-y-1 mb-2">
          <span>{{ .Date.Format "2006-01-02" }}</span>
          <span>·</span>
          <span>{{ .ReadingTime }} min</span>
          {{ with .Params.authors }}<span>·</span><span>{{ delimit . ", " }}</span>{{ end }}
        </div>

        {{ $sum := .Params.summary }}
        {{ if not $sum }}{{ $sum = ( .Plain | truncate 160 ) }}{{ end }}
        {{ with $sum }}<p class="text-sm text-gray-700 dark:text-gray-200 mb-2">{{ . | safeHTML }}</p>{{ end }}

        {{ with .Params.categories }}
          <div class="flex flex-wrap gap-1.5 mt-2">
            {{ range . }}<span class="inline-block text-[11px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100">{{ . }}</span>{{ end }}
          </div>
        {{ end }}

        <a href="{{ .RelPermalink }}" class="absolute inset-0" aria-label="{{ .Title }}"></a>
      </article>
    {{ end }}
  </div>

  <!-- Paginación -->
  <div class="mt-10">
    {{ template "_internal/pagination.html" . }}
  </div>

  <!-- JS para filtrar por categoría -->
  <script>
    (function(){
      const chips = Array.from(document.querySelectorAll('#cat-filter [data-cat]'));
      const cards = Array.from(document.querySelectorAll('#post-grid article'));
      let current='__all__';
      function apply(){
        cards.forEach(c=>{
          const cats=(c.dataset.cats||'').split(/\s+/).filter(Boolean);
          c.style.display = (current==='__all__' || cats.includes(current)) ? '' : 'none';
        });
      }
      chips.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          chips.forEach(b=>b.classList.remove('ring-1','ring-gray-400'));
          btn.classList.add('ring-1','ring-gray-400');
          current=btn.dataset.cat;
          apply();
        });
      });
    })();
  </script>
</section>
{{ end }}
