{{ define "main" }}
{{ $isEN := eq .Site.Language.Lang "en" }}
{{ $btnDefault := cond $isEN "Learn more" "Más sobre el evento" }}
{{ $materialsLabel := cond $isEN "Materials" "Materiales" }}
{{ $empty := cond $isEN "No events loaded yet." "No hay eventos cargados aún." }}

<section class="mx-auto px-6 py-10 max-w-6xl">

  <!-- Title -->
  <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">{{ .Title }}</h1>

  <!-- Subtitle -->
  <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
    {{ if $isEN }}
      Selected events, talks, and workshops with MetaDocencia’s participation.
    {{ else }}
      Participamos en eventos regionales e internacionales organizando, dictando y acompañando talleres, paneles y presentaciones que ayudan a visibilizar perspectivas latinoamericanas sobre Ciencia Abierta, fortalecer redes de colaboración y construir capacidades desde y para la región.
    {{ end }}
  </p>

  {{ $items := .Params.items }}
  {{ if $items }}
    <!-- Grid de tarjetas -->
    <div class="mt-8 grid gap-6 md:grid-cols-2 xl:grid-cols-3">
      {{ range $items }}
        {{ $item := . }}

        <article class="bg-white dark:bg-gray-900 rounded-xl shadow-sm border border-gray-200/70 dark:border-gray-800 overflow-hidden flex flex-col">
          
          <!-- Imagen del evento -->
          {{ with $item.image }}
            <div class="aspect-[4/3] w-full overflow-hidden">
              <img src="{{ . | safeURL }}"
                   alt="{{ with $item.image_alt }}{{ . }}{{ else }}{{ $item.title }}{{ end }}"
                   class="h-full w-full object-cover">
            </div>
          {{ end }}

          <!-- Contenido de la tarjeta -->
          <div class="p-5 flex flex-col flex-1">
            <!-- Meta: fecha + lugar -->
            <div class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">
              {{ with $item.date }}<span>{{ . }}</span>{{ end }}
              {{ if and $item.date $item.place }} · {{ end }}
              {{ with $item.place }}<span>{{ . }}</span>{{ end }}
            </div>

            <!-- Título -->
            <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-50 leading-snug">
              {{ $item.title }}
            </h2>

            <!-- Bajada -->
            {{ with $item.summary }}
              <p class="mt-2 text-sm text-gray-700 dark:text-gray-200">
                {{ . }}
              </p>
            {{ end }}

            <!-- Enlaces -->
            <div class="mt-4 flex flex-wrap gap-3 items-center">
              <!-- Enlace principal -->
              {{ with $item.url }}
                {{/* Texto del botón: se puede sobreescribir por item */}}
                {{ $btnText := $btnDefault }}
                {{ with $item.btn }}{{ $btnText = . }}{{ end }}
                {{ if and (eq $btnText $btnDefault) $isEN }}
                  {{ with $item.btn_en }}{{ $btnText = . }}{{ end }}
                {{ end }}
                {{ if and (eq $btnText $btnDefault) (not $isEN) }}
                  {{ with $item.btn_es }}{{ $btnText = . }}{{ end }}
                {{ end }}

                <a href="{{ . }}" target="_blank" rel="noopener"
                   class="inline-flex items-center text-sm font-semibold text-[#00506F] hover:underline">
                  {{ $btnText }}
                  <span aria-hidden="true" class="ml-1">↗</span>
                </a>
              {{ end }}

              <!-- Enlace a materiales -->
              {{ with $item.materials_url }}
                <a href="{{ . }}" target="_blank" rel="noopener"
                   class="inline-flex items-center text-sm font-semibold text-[#00506F] hover:underline">
                  {{ $materialsLabel }}
                  <span aria-hidden="true" class="ml-1">↗</span>
                </a>
              {{ end }}
            </div>
          </div>
        </article>
      {{ end }}
    </div>
  {{ else }}
    <p class="mt-6 text-sm text-gray-500 dark:text-gray-400">{{ $empty }}</p>
  {{ end }}

</section>

<!-- Estilos mínimos locales -->
<style>
  .prose iframe { width: 100% !important; aspect-ratio: 16/9; height: auto; }
  .prose img { height: auto; }
</style>
{{ end }}
