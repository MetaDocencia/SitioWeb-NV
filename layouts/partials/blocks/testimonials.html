{{/* layouts/partials/blocks/testimonials.html */}}
{{- $block := . -}}
{{- $id := $block.id | default (printf "testimonials-%d" now.Unix) -}}

<section id="{{ $id }}" class="section-testimonials {{ with $block.design.css_class }}{{ . }}{{ end }}" {{ with $block.design.css_style }}style="{{ . }}"{{ end }} aria-label="Testimonios">
  <div class="container mx-auto px-6 md:px-8 lg:px-10">

    {{ with $block.content.title }}
      <h2 class="text-2xl md:text-3xl font-extrabold tracking-tight mb-2">
        {{ . | $.Page.RenderString }}
      </h2>
    {{ end }}

    {{ with $block.content.text }}
      <div class="prose max-w-none mb-4 text-gray-700 dark:text-gray-200">
        {{ . | $.Page.RenderString }}
      </div>
    {{ end }}

    {{ $items := $block.content.items }}
    {{ if $items }}
      <div class="space-y-8">
        {{ range $items }}
          <article class="p-0">
            {{ with .name }}
              <div class="text-lg font-semibold leading-snug text-gray-900 dark:text-white">
                {{ . }}
              </div>
            {{ end }}

            {{ with .role }}
              <div class="text-sm text-gray-600 dark:text-gray-300 mt-0.5">
                {{ . | $.Page.RenderString }}
              </div>
            {{ end }}

            {{ with .text }}
              <!-- Campo de texto del testimonial (permite Markdown y enlaces subrayados) -->
              <div class="mt-3 text-gray-800 dark:text-gray-100 testimonial-text">
                {{ . | $.Page.RenderString }}
              </div>
            {{ end }}
          </article>
        {{ end }}
      </div>
    {{ else }}
      <p class="text-sm text-gray-500 dark:text-gray-400">No hay testimonios a√∫n.</p>
    {{ end }}

  </div>
</section>

<style>
  /* ===== Ajustes visuales base ===== */
  #{{ $id }} .prose iframe {
    width: 100% !important;
    aspect-ratio: 16 / 9;
    height: auto;
  }

  #{{ $id }} .prose img {
    height: auto;
  }

  /* ===== Subrayado consistente para enlaces dentro del campo `text` ===== */
  #{{ $id }} .testimonial-text a,
  #{{ $id }} .testimonial-text a[class],
  #{{ $id }} .testimonial-text a:not(:where(.no-underline)) {
    text-decoration-line: underline !important;
    text-underline-offset: 0.15em;
    text-decoration-thickness: 1.5px;
    text-decoration-skip-ink: auto;
  }

  /* En caso de que el tema use `.no-underline`, forzamos el subrayado igual */
  #{{ $id }} .testimonial-text a.no-underline {
    text-decoration-line: underline !important;
  }

  /* Accesibilidad: foco visible al navegar con teclado */
  #{{ $id }} .testimonial-text a:focus-visible {
    outline: 2px solid currentColor;
    outline-offset: 2px;
  }
</style>
