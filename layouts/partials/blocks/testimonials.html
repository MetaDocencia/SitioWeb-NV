{{/* layouts/partials/blocks/testimonials.html */}}
{{- $block := . -}}
{{- $id := $block.id | default (printf "testimonials-%d" now.Unix) -}}

<section id="{{ $id }}" class="section-testimonials {{ with $block.design.css_class }}{{ . }}{{ end }}" {{ with $block.design.css_style }}style="{{ . }}"{{ end }} aria-label="Testimonios">
  <div class="container mx-auto px-6 md:px-8 lg:px-10">

    {{ with $block.content.title }}
      <h2 class="text-2xl md:text-3xl font-extrabold tracking-tight mb-2">
        {{ . | $.Page.RenderString }}
      </h2>
    {{ end }}

    {{ with $block.content.text }}
      <div class="prose max-w-none mb-4 text-gray-700 dark:text-gray-200">
        {{ . | $.Page.RenderString }}
      </div>
    {{ end }}

    {{ $items := $block.content.items }}
    {{ if $items }}
      <div class="space-y-8">
        {{ range $items }}
          <article class="p-0">
            {{ with .name }}
              <div class="text-lg font-semibold leading-snug text-gray-900 dark:text-white">
                {{ . }}
              </div>
            {{ end }}

            {{ with .role }}
              <div class="text-sm text-gray-600 dark:text-gray-300 mt-0.5">
                {{ . | $.Page.RenderString }}
              </div>
            {{ end }}

            {{ with .text }}
              {{/* 
                Capa 1 (Tailwind): 
                - Agregamos 'prose' para que Typography no quite subrayado
                - 'prose-a:underline' + grosor del subrayado
              */}}
              <div class="mt-3 text-gray-800 dark:text-gray-100 testimonial-text prose prose-a:underline prose-a:decoration-2">
                {{ . | $.Page.RenderString }}
              </div>
            {{ end }}
          </article>
        {{ end }}
      </div>
    {{ else }}
      <p class="text-sm text-gray-500 dark:text-gray-400">No hay testimonios aún.</p>
    {{ end }}

  </div>
</section>

<style>
  /* ===== Ajustes visuales base ===== */
  #{{ $id }} .prose iframe { width: 100% !important; aspect-ratio: 16 / 9; height: auto; }
  #{{ $id }} .prose img { height: auto; }

  /* ===== Capa 2 (CSS con alta especificidad + !important) =====
     Forzamos subrayado SOLO en el campo `text` de testimoniales,
     incluso si hay reglas globales como a { text-decoration: none !important } */
  #{{ $id }} .testimonial-text a,
  #{{ $id }} .testimonial-text a[class],
  #{{ $id }} .testimonial-text :where(a) {
    text-decoration-line: underline !important;
    text-underline-offset: 0.15em !important;
    text-decoration-thickness: 1.5px !important;
    text-decoration-skip-ink: auto !important;
  }
  /* Si el tema aplica .no-underline a los links */
  #{{ $id }} .testimonial-text a.no-underline {
    text-decoration-line: underline !important;
  }
  /* Hover accesible */
  #{{ $id }} .testimonial-text a:hover {
    text-decoration-thickness: 2px !important;
  }
  /* Foco visible para teclado */
  #{{ $id }} .testimonial-text a:focus-visible {
    outline: 2px solid currentColor;
    outline-offset: 2px;
  }

  /* ===== Capa 3 (fallback visual) =====
     En el caso extremo de que alguna cadena de estilos bloquee text-decoration,
     simulamos el subrayado con un subrayado "falso" vía box-shadow. */
  @supports not (text-decoration-thickness: 1px) {
    #{{ $id }} .testimonial-text a,
    #{{ $id }} .testimonial-text :where(a) {
      text-decoration: none !important;
      box-shadow: inset 0 -1px 0 currentColor !important;
    }
  }
</style>
