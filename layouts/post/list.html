{{ define "main" }}
<section class="container mx-auto px-6 py-8">
  <!-- Título -->
  <h1 class="text-3xl font-extrabold tracking-tight mb-6">
    {{ if eq .Site.Language.Lang "es" }}Blog{{ else }}Blog{{ end }}
  </h1>

  <!-- Filtro por etiquetas -->
  {{ with site.Taxonomies.tags }}
    <div class="flex flex-wrap gap-2 mb-8">
      <a href="{{ "/post/" | relLangURL }}"
         class="px-3 py-1 rounded-full border border-gray-300 text-gray-700 hover:bg-gray-100
                dark:border-gray-700 dark:text-gray-200 dark:hover:bg-gray-800">
        {{ if eq $.Site.Language.Lang "es" }}Todas{{ else }}All{{ end }}
      </a>
      {{ range $tag, $_ := . }}
        <a href="{{ (printf "/tags/%s/" (urlize $tag)) | relLangURL }}"
           class="px-3 py-1 rounded-full bg-gray-100 text-gray-800 hover:bg-gray-200
                  dark:bg-gray-800 dark:text-gray-100 dark:hover:bg-gray-700">
          {{ $tag }}
        </a>
      {{ end }}
    </div>
  {{ end }}

  {{/* Páginas de ESTA sección (post), ordenadas desc */}}
  {{ $pages := .Pages.ByDate.Reverse }}
  {{ $p := .Paginate $pages }}

  <!-- Grid de tarjetas (similar a mdnv.netlify.app/blog) -->
  <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
    {{ range $p.Pages }}
      <article class="bg-white border border-gray-200 rounded-2xl overflow-hidden shadow-sm
                      hover:shadow-lg hover:border-gray-300 transition
                      dark:bg-gray-900 dark:border-gray-800 dark:hover:border-gray-700">
        {{/* Imagen destacada si existe: featured*/cover* como Page Bundle Resource o .Params.image */}}
        {{ $img := "" }}
        {{ with .Resources.GetMatch "featured*" }}{{ $img = .RelPermalink }}{{ end }}
        {{ if eq $img "" }}{{ with .Resources.GetMatch "cover*" }}{{ $img = .RelPermalink }}{{ end }}{{ end }}
        {{ if and (eq $img "") .Params.image }}{{ $img = .Params.image }}{{ end }}

        {{ if $img }}
          <a href="{{ .RelPermalink }}"><img src="{{ $img }}" alt="{{ .Title }}" class="w-full object-cover" style="aspect-ratio:16/9;"></a>
        {{ end }}

        <div class="p-5">
          <h2 class="text-xl font-bold leading-snug mb-1">
            <a href="{{ .RelPermalink }}" class="hover:underline">{{ .Title }}</a>
          </h2>

          <div class="flex flex-wrap items-center gap-x-2 gap-y-1 text-sm text-gray-500 dark:text-gray-400 mb-3">
            <span>{{ .Date.Format "2006-01-02" }}</span>
            <span>·</span>
            <span>
              {{ if eq $.Site.Language.Lang "es" }}{{ .ReadingTime }} min de lectura{{ else }}{{ .ReadingTime }} min read{{ end }}
            </span>
            {{ with .Params.authors }}
              <span>·</span>
              <span>{{ delimit . ", " }}</span>
            {{ end }}
          </div>

          {{/* Extracto sin “Read more” (tomamos summary si lo hay; si no, truncamos el texto plano) */}}
          {{ $sum := .Params.summary }}
          {{ if not $sum }}
            {{ $sum = ( .Plain | truncate 220 ) }}
          {{ end }}
          {{ with $sum }}
            <p class="text-gray-700 dark:text-gray-200 mb-3">{{ . | safeHTML }}</p>
          {{ end }}

          {{ with .Params.tags }}
            <div class="flex flex-wrap gap-2">
              {{ range . }}
                <a href="{{ (printf "/tags/%s/" (urlize .)) | relLangURL }}"
                   class="text-xs px-2.5 py-1 rounded-full bg-gray-100 text-gray-800
                          dark:bg-gray-800 dark:text-gray-100">
                  {{ . }}
                </a>
              {{ end }}
            </div>
          {{ end }}
        </div>
      </article>
    {{ end }}
  </div>

  <!-- Paginación -->
  <div class="mt-10">
    {{ template "_internal/pagination.html" . }}
  </div>
</section>
{{ end }}
