{{ define "main" }}
<section class="mx-auto px-6 py-10 max-w-6xl grid grid-cols-1 md:grid-cols-12 gap-10">

  {{/* ====== Sidebar (foto + nombre + rol + redes) ====== */}}
  <aside class="md:col-span-4 lg:col-span-3">
    {{/* Resolver avatar: front matter -> avatar.* en carpeta -> primera imagen */}}
    {{ $avatar := "" }}
    {{ with .Params.avatar }}{{ $avatar = . }}{{ end }}
    {{ if not $avatar }}
      {{ with .Resources.GetMatch "avatar*" }}{{ $avatar = .RelPermalink }}{{ end }}
    {{ end }}
    {{ if not $avatar }}
      {{ with .Resources.ByType "image" }}{{ with index . 0 }}{{ $avatar = .RelPermalink }}{{ end }}{{ end }}
    {{ end }}

    {{ if $avatar }}
      <img src="{{ $avatar }}" alt="{{ .Title }}"
           class="w-40 h-40 rounded-full object-cover mb-4 mx-auto md:mx-0 shadow" />
    {{ end }}

    <h1 class="text-2xl font-bold mb-1">{{ .Title }}</h1>

    {{/* Rol (puede venir vacío) */}}
    {{ with .Params.role }}
      {{ if . }}
        <p class="text-gray-600 dark:text-gray-400 mb-1">{{ . }}</p>
      {{ end }}
    {{ end }}

    {{/* Organización (lista) */}}
    {{ with .Params.organizations }}
      {{ range . }}
        {{ if .name }}
          {{ if .url }}
            <p class="text-sm"><a href="{{ .url }}" class="text-gray-500 dark:text-gray-400 hover:underline">{{ .name }}</a></p>
          {{ else }}
            <p class="text-sm text-gray-500 dark:text-gray-400">{{ .name }}</p>
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}

    {{/* Redes sociales (icon_pack/icon/link como en Academic/Blox) */}}
    {{ with .Params.social }}
      <div class="flex flex-wrap gap-3 mt-4">
        {{ range . }}
          {{/* Normalizar mailto si falta */}}
          {{ $href := .link }}
          {{ if and (eq .icon "envelope") (not (hasPrefix $href "mailto:")) }}
            {{ $href = printf "mailto:%s" $href }}
          {{ end }}
          <a href="{{ $href }}" target="_blank" rel="noopener"
             class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-gray-300 dark:border-gray-700 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800">
            <i class="{{ .icon_pack }} fa-{{ .icon }}"></i>
          </a>
        {{ end }}
      </div>
    {{ end }}
  </aside>

  {{/* ====== Columna principal ====== */}}
  <div class="md:col-span-8 lg:col-span-9 space-y-10">

    {{/* Experiencia y trayectoria: usa el contenido del author */}}
    {{ with .Content }}
      <div class="prose dark:prose-invert max-w-none">
        {{ . }}
      </div>
    {{ end }}

    {{/* Intereses */}}
    {{ with .Params.interests }}
      {{ if gt (len .) 0 }}
        <section>
          <h2 class="text-xl font-semibold mb-3">Intereses</h2>
          <ul class="list-disc list-inside text-gray-700 dark:text-gray-300">
            {{ range . }}<li>{{ . }}</li>{{ end }}
          </ul>
        </section>
      {{ end }}
    {{ end }}

    {{/* Educación (education.courses) */}}
    {{ with .Params.education.courses }}
      {{ if gt (len .) 0 }}
        <section>
          <h2 class="text-xl font-semibold mb-3">Educación</h2>
          <ul class="list-disc list-inside text-gray-700 dark:text-gray-300 space-y-1">
            {{ range . }}
              <li>
                {{ .course }}
                {{ with .institution }} — {{ . }}{{ end }}
                {{ with .year }} ({{ . }}){{ end }}
              </li>
            {{ end }}
          </ul>
        </section>
      {{ end }}
    {{ end }}

    {{/* Publicaciones del autor: minimalista con "ver más" si hay muchas */}}
    <section>
      <h2 class="text-xl font-semibold mb-3">Publicaciones</h2>

      {{/* Derivar el slug del autor desde la ruta del archivo (carpeta de _index.md) */}}
      {{ $slug := path.Base (path.Dir .File.Path) }}
      {{ $all := where site.RegularPages "Params.authors" "intersect" (slice $slug) }}
      {{ $all = sort $all "Date" "desc" }}
      {{ $n := len $all }}

      {{ if eq $n 0 }}
        <p class="text-sm text-gray-500">Aún no hay publicaciones listadas para este autor/a.</p>
      {{ else }}
        {{ $limit := 8 }}
        <div class="space-y-4">
          {{ range $i, $p := $all }}
            {{ if lt $i $limit }}
              <article class="border-l-2 border-gray-300 dark:border-gray-700 pl-3">
                <a href="{{ $p.RelPermalink }}" class="text-base font-medium hover:underline">{{ $p.Title }}</a>
                <p class="text-xs text-gray-500">{{ $p.Date.Format "2006-01-02" }}</p>
              </article>
            {{ end }}
          {{ end }}
        </div>

        {{ if gt $n $limit }}
          <details class="mt-4">
            <summary class="cursor-pointer text-sm text-gray-700 dark:text-gray-300 hover:underline">
              Mostrar {{ sub $n $limit }} más
            </summary>
            <div class="mt-3 space-y-4">
              {{ range $i, $p := $all }}
                {{ if ge $i $limit }}
                  <article class="border-l-2 border-gray-300 dark:border-gray-700 pl-3">
                    <a href="{{ $p.RelPermalink }}" class="text-base font-medium hover:underline">{{ $p.Title }}</a>
                    <p class="text-xs text-gray-500">{{ $p.Date.Format "2006-01-02" }}</p>
                  </article>
                {{ end }}
              {{ end }}
            </div>
          </details>
        {{ end }}
      {{ end }}
    </section>

  </div>
</section>
{{ end }}
